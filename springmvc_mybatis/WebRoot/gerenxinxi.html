<!DOCTYPE HTML>
<html>
<head>
<!-- <meta content="no-siteapp" http-equiv="Cache-Control"> -->
<!-- <link media="handheld" rel="alternate"> -->
<!-- end 云适配 -->
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>个人信息</title>
<!-- <meta content="23635710066417756375" property="qc:admins"> -->
<meta name="description" content="">
<meta name="keywords" content="">
<!-- <meta content="QIQ6KC1oZ6" name="baidu-site-verification"> -->
<link rel="stylesheet" type="text/css" href="style/css/style.css"/>
<link rel="stylesheet" href="layui/css/layui.css" media="all">
<script src="style/js/jquery.1.10.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="style/js/util.js"></script>
<script type="text/javascript" src="style/js/menu.js"></script>
<style type="text/css">
.mt30 {
	margin-top: 30px;
}

.layui-form-label {
	width: 100px
}

.layui-input-block {
	margin-left: 130px
}
input[type="text"], input[type="password"] {
    width: 100%;
    height: 38px;
    /* outline: none; */
    /* font: 20px/32px "微软雅黑","宋体",Arial; */
    /* width: 600px; */
    /* height: 30px; */
    /* padding: 6px 10px; */
    /* margin-top: 20px; */
    /* transition: border 0.2s ease-in 0s; */
}
</style>
<body>
	<div id="body">
		<div id="header">
			<div class="wrapper">
				<a href="index.html" class="logo">
					<img src="style/images/schoolLogo.png" width="229" height="43" alt="此处放logo" />
				</a>
				<ul class="reset" id="navheader">
					<li class="current"><a href="index.html">首页</a></li>
					<li ><a href="myhome.html" >本机构信息</a></li>
					<!-- <li ><a href="h/toForum.html" target="_blank">论坛</a></li> -->
					<li ><a href="jianli.html" rel="nofollow">我的简历</a></li>
					<li ><a href="create.html" rel="nofollow">发布职位</a></li>
					<li ><a href="collections.html" rel="nofollow">我收藏的职位</a></li>
				</ul>
				<ul class="loginTop none" id="js-loginAndReg">
					<li><a href="login.html" rel="nofollow">登录</a></li> 
					<li>|</li>
					<li><a href="register.html" rel="nofollow">注册</a></li>
				</ul>
				<dl class="collapsible_menu none" id="js-userDl">
	            	<dt style='min-width: auto'>
	           			<span id='js-user-span'>jason&nbsp;</span> 
	            		<span class="red dn" id="noticeDot-1"></span>
	            		<i></i>
	            	</dt>
                    <dd><a href="updatePwd.html">帐号设置</a></dd>
                    <dd class="logout"><a rel="nofollow" href="login.html">退出</a></dd>
            	</dl>
			</div>
		</div><!-- end #header -->
		<div id="container">
			<fieldset class="layui-elem-field layui-field-title"
				style="margin-top: 20px;">
				<legend>个人信息</legend>
			</fieldset>
			<form class="layui-form mt30" action="javascript:void(0)" style="width: 800px;">
				<input type='hidden' id='js-hidden-id' name='id' />
				<div class="layui-form-item">
					<label class="layui-form-label">身份：</label>
					<div class="layui-input-block">
						<select name="type" lay-filter="typeFilter">
							<option value="1">学生</option>
							<option value="2">招聘者</option>
						</select>
					</div>
				</div>
				<div id="js-student">
					<div class="layui-form-item">
						<label class="layui-form-label">学校名称：</label>
						<div class="layui-input-block">
							<input type="text" name="xxmc" id="xxmc"
								placeholder="请输入学校名称" autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">专业名称：</label>
						<div class="layui-input-block">
							<input type="text" name="zymc" id="zymc"
								placeholder="专业名称" autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">上传学生证：</label>
						<div class="layui-input-block">
							<button type="button" class="layui-btn" id="js-upload-student">上传图片</button>
							<div class="layui-upload-list">
								<img class="layui-upload-img" id="studentImg">
							</div>
						</div>
					</div>
				</div>
				<div id="js-zpz" style="display: none;">
					<div class="layui-form-item">
						<label class="layui-form-label">上传身份证：</label>
						<div class="layui-input-block">
							<button type="button" class="layui-btn" id="js-zpz-upload-identity">上传图片</button>
							<div class="layui-upload-list">
								<img class="layui-upload-img" id="zpz-identityImg">
							</div>
						</div>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">手机号码：</label>
					<div class="layui-input-block">
						<input type="number" name="sjhm" lay-verify="required|phone" id="sjhm"
							placeholder="手机号码" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">姓名：</label>
					<div class="layui-input-block">
						<input type="text" name="xm" id="xm" lay-verify="required" placeholder="姓名"
							autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">身份证号码：</label>
					<div class="layui-input-block">
						<input type="text" name="sfzhm" id="sfzhm" lay-verify="required|identity"
							placeholder="身份证号码" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">上传头像：</label>
					<div class="layui-input-block">
						<button type="button" class="layui-btn" id="js-upload-head">上传图片</button>
						<div class="layui-upload-list">
							<img class="layui-upload-img" id="headImg">
						</div>
					</div>
				</div>
				<div class="layui-form-item">
					<div class="layui-input-block">
						<button class="layui-btn" lay-submit lay-filter="formSubmit">立即提交</button>
						<button type="reset" class="layui-btn layui-btn-primary">重置</button>
					</div>
				</div>
			</form>
		</div>
	</div>
	
	<script type="text/javascript" src="layui/layui.js"></script>
	<script type="text/javascript">
		layui.use([ 'layer', 'form', 'element', 'upload' ], function() {
			var form = layui.form, $ = layui.$, layer = layui.layer, 
			upload = layui.upload;
			var user = sessionStorage.getItem("user");
			console.log(user);
			$.ajax({
				url: getServerUrl('/bjgrxx'),
				type: "post",
				async: false,
				contentType: "application/json;charset=utf-8",
				success: function(data) {
					console.log(data);
					var userData = data.result.data;
					if(userData.type == 1) {
						$("#xxmc").val(userData.xxmc);
						$("#zymc").val(userData.zymc);
						$("#studentImg").attr('src', userData.tplj);
						$("#studentImg").attr('data-src', userData.tplj);
					} else {
						$("#zpz-identityImg").attr('src', userData.tplj);
						$("#zpz-identityImg").attr('data-src', userData.tplj);
					}
					$("#js-hidden-id").val(userData.id);
					$("#sjhm").val(userData.sjhm);
					$("#xm").val(userData.xm);
					$("#sfzhm").val(userData.sfzhm);
					$("#headImg").attr('src', userData.txzp);
					$("#headImg").attr('data-src', userData.txzp);
				}
			});
			form.on('select(typeFilter)', function(data) {
				console.log(data.elem); //得到select原始DOM对象
				console.log(data.value); //得到被选中的值
				console.log(data.othis); //得到美化后的DOM对象
				if (data.value == 1) {
					$("#js-student").show();
					$("#js-zpz").hide();
				} else {
					$("#js-zpz").show();
					$("#js-student").hide();
				}
			});
			form.on('submit(formSubmit)', function(data){
			  console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
			  console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
			  var paramMap = data.field;
			  delete paramMap.file
			  console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
			  if(paramMap.type == 1) {
				  paramMap['tplj'] = $('#studentImg').attr('data-src');
			  } else {
				  delete paramMap.xxmc;
				  delete paramMap.zymc;
				  paramMap['tplj'] = $('#zpz-identityImg').attr('data-src');
			  }
			  paramMap['txzp'] = $('#headImg').attr('data-src');
			  $.ajax({
					url: getServerUrl('/bcgrxx'),
					type: "post",
					data: JSON.stringify(paramMap),
					contentType: "application/json;charset=utf-8",
					success: function(data) {
						console.log(data);
						if(data.result.success == true) {
							layer.msg('保存成功');
						} else {
							layer.msg('保存失败');
						}
						
					}
			  });
			});
			//普通图片上传
			  var uploadInst = upload.render({
			    elem: '#js-upload-student'
			    ,url: getServerUrl('/upload')
			    ,before: function(obj){
			      //预读本地文件示例，不支持ie8
			      obj.preview(function(index, file, result){
			        $('#studentImg').attr('src', result); //图片链接（base64）
			      });
			    }
			    ,done: function(res){
			      //如果上传失败
			      if(res.success == false){
			        return layer.msg('上传失败');
			      }
			      //上传成功
			      $('#studentImg').attr('data-src', res.result.url);
			    }
			    ,error: function(){
			      //演示失败状态，并实现重传
			      layer.msg("上传失败");
			    }
			  });
			  var uploadInst2 = upload.render({
				    elem: '#js-zpz-upload-identity'
				    ,url: getServerUrl('/upload')
				    ,before: function(obj){
				      //预读本地文件示例，不支持ie8
				      obj.preview(function(index, file, result){
				        $('#zpz-identityImg').attr('src', result); //图片链接（base64）
				      });
				    }
				    ,done: function(res){
				      //如果上传失败
				      if(res.success == false){
				        return layer.msg('上传失败');
				      }
				      //上传成功
				      $('#zpz-identityImg').attr('data-src', res.result.url);
				    }
				    ,error: function(){
				      //演示失败状态，并实现重传
				      layer.msg("上传失败");
				    }
				  });
			  var uploadInst3 = upload.render({
				    elem: '#js-upload-head'
				    ,url: getServerUrl('/upload')
				    ,before: function(obj){
				      //预读本地文件示例，不支持ie8
				      obj.preview(function(index, file, result){
				        $('#headImg').attr('src', result); //图片链接（base64）
				      });
				    }
				    ,done: function(res){
				      //如果上传失败
				      if(res.success == false){
				        return layer.msg('上传失败');
				      }
				      //上传成功
				      $('#headImg').attr('data-src', res.result.url);
				    }
				    ,error: function(){
				      //演示失败状态，并实现重传
				      layer.msg("上传失败");
				    }
				  });
		});
	</script>
<script type="text/javascript" src="style/js/core.min.js"></script>
</body>
</html>
